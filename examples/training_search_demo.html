<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training vs Searchable Documents Demo - Japanese Text Vector</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        h1 {
            color: white;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.9);
            text-align: center;
            font-size: 1.1em;
            margin-bottom: 40px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        h3 {
            color: #555;
            margin-top: 20px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .demo-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .result-item {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .result-score {
            float: right;
            color: #667eea;
            font-weight: bold;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre;
            margin: 0;
        }
        
        .code-block code {
            font-family: inherit;
            font-size: inherit;
            background: none;
            padding: 0;
            color: #333;
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Training vs Searchable Documents</h1>
        <p class="subtitle">å­¦ç¿’å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ã¨æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢ãƒ‡ãƒ¢</p>

        <div class="panel">
            <h2>ğŸ“Š çµ±è¨ˆæƒ…å ±</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-docs">0</div>
                    <div class="stat-label">å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="training-docs">0</div>
                    <div class="stat-label">å­¦ç¿’å°‚ç”¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="searchable-docs">0</div>
                    <div class="stat-label">æ¤œç´¢å¯¾è±¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="vocab-size">0</div>
                    <div class="stat-label">èªå½™ã‚µã‚¤ã‚º</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>ğŸ”„ ãƒ¢ãƒ‡ãƒ«å†å­¦ç¿’</h2>
            <div style="display: flex; align-items: center; gap: 20px; margin: 20px 0;">
                <button onclick="forceRetrain()" id="retrain-btn">å¼·åˆ¶å†å­¦ç¿’ã‚’å®Ÿè¡Œ</button>
                <div style="flex: 1;">
                    <div id="retrain-status" style="color: #666;">å¾…æ©Ÿä¸­</div>
                    <progress id="retrain-progress" value="0" max="100" style="width: 100%; display: none;"></progress>
                </div>
            </div>
            <div class="info-box">
                <strong>è‡ªå‹•å†å­¦ç¿’:</strong> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°ã®10%ä»¥ä¸ŠãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«å†å­¦ç¿’ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚
                å¼·åˆ¶å†å­¦ç¿’ãƒœã‚¿ãƒ³ã§æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½ã§ã™ã€‚
            </div>
        </div>

        <div class="panel">
            <h2>â• ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ </h2>
            
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('training')">å­¦ç¿’å°‚ç”¨ãƒ‡ãƒ¼ã‚¿</button>
                <button class="tab-button" onclick="switchTab('searchable')">æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿</button>
                <button class="tab-button" onclick="switchTab('batch')">ãƒãƒƒãƒè¿½åŠ </button>
            </div>
            
            <div id="training-tab" class="tab-content active">
                <div class="info-box">
                    <strong>å­¦ç¿’å°‚ç”¨ãƒ‡ãƒ¼ã‚¿:</strong> ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã«ã¯ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€æ¤œç´¢çµæœã«ã¯ç¾ã‚Œã¾ã›ã‚“ã€‚
                    èƒŒæ™¯çŸ¥è­˜ã‚„æ–‡è„ˆæƒ…å ±ã¨ã—ã¦æ´»ç”¨ã•ã‚Œã¾ã™ã€‚
                </div>
                <textarea id="training-input" rows="3" placeholder="å­¦ç¿’å°‚ç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">æ©Ÿæ¢°å­¦ç¿’ã¯äººå·¥çŸ¥èƒ½ã®ä¸€åˆ†é‡ã§ã™ã€‚</textarea>
                <button onclick="addTrainingDoc()">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ </button>
            </div>
            
            <div id="searchable-tab" class="tab-content">
                <div class="info-box">
                    <strong>æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿:</strong> å­¦ç¿’ã«ã‚‚ä½¿ç”¨ã•ã‚Œã€æ¤œç´¢çµæœã¨ã—ã¦è¿”ã•ã‚Œã¾ã™ã€‚
                    å®Ÿéš›ã«æ¤œç´¢ã—ãŸã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã—ã¾ã™ã€‚
                </div>
                <textarea id="searchable-input" rows="3" placeholder="æ¤œç´¢å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">æ·±å±¤å­¦ç¿’ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚</textarea>
                <button onclick="addSearchableDoc()">æ¤œç´¢å¯¾è±¡ã¨ã—ã¦è¿½åŠ </button>
            </div>
            
            <div id="batch-tab" class="tab-content">
                <div class="info-box">
                    <strong>ãƒãƒƒãƒè¿½åŠ :</strong> ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ã§è¿½åŠ ã§ãã¾ã™ã€‚
                </div>
                <button onclick="addSampleTrainingData()">å­¦ç¿’ç”¨ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ ï¼ˆ100ä»¶ï¼‰</button>
                <button onclick="addSampleSearchableData()">æ¤œç´¢å¯¾è±¡ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ ï¼ˆ20ä»¶ï¼‰</button>
            </div>
        </div>

        <div class="panel">
            <h2>ğŸ” é¡ä¼¼æ¤œç´¢</h2>
            
            <textarea id="query-input" rows="2" placeholder="æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’å…¥åŠ›...">äººå·¥çŸ¥èƒ½ã®å¿œç”¨</textarea>
            <button onclick="searchSimilar()">æ¤œç´¢å®Ÿè¡Œ</button>
            <button onclick="searchWithScores()">ã‚¹ã‚³ã‚¢ä»˜ãæ¤œç´¢</button>
            
            <div id="search-results" style="margin-top: 20px;">
                <!-- æ¤œç´¢çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>

        <div class="panel">
            <h2>ğŸ’¡ ä½¿ç”¨ä¾‹</h2>
            <pre class="code-block"><code>// å¤§é‡ã®èƒŒæ™¯çŸ¥è­˜ã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ 
for (let doc of wikipediaArticles) {
    embedder.add_document_for_training(doc, 64);
}

// å®Ÿéš›ã«æ¤œç´¢ã—ãŸã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
for (let doc of productDescriptions) {
    embedder.add_document(doc, 64);
}

// é«˜é€Ÿæ¤œç´¢ï¼ˆæ¤œç´¢å¯¾è±¡ã®ã¿ã‹ã‚‰çµæœãŒè¿”ã‚‹ï¼‰
const results = embedder.find_similar("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒª", 10);</code></pre>
        </div>
    </div>

    <script type="module">
        import init, { IncrementalEmbedder } from '../pkg/japanese_tfidf_embedder.js';
        
        let embedder;
        let totalDocCount = 0;
        let trainingOnlyCount = 0;
        
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const trainingData = [
            "è‡ªç„¶è¨€èªå‡¦ç†ã¯äººå·¥çŸ¥èƒ½ã®é‡è¦ãªåˆ†é‡ã§ã™ã€‚",
            "æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¯æ§˜ã€…ãªç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚",
            "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯è„³ã®ä»•çµ„ã¿ã‚’æ¨¡å€£ã—ã¦ã„ã¾ã™ã€‚",
            "æ·±å±¤å­¦ç¿’ã¯å¤šå±¤ã®ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚",
            "å¼·åŒ–å­¦ç¿’ã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç’°å¢ƒã‹ã‚‰å­¦ç¿’ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚",
            "æ•™å¸«ã‚ã‚Šå­¦ç¿’ã«ã¯ãƒ©ãƒ™ãƒ«ä»˜ããƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚",
            "æ•™å¸«ãªã—å­¦ç¿’ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•çš„ã«ç™ºè¦‹ã—ã¾ã™ã€‚",
            "è»¢ç§»å­¦ç¿’ã«ã‚ˆã‚Šå°‘ãªã„ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’ãŒå¯èƒ½ã§ã™ã€‚",
            "è‡ªç„¶è¨€èªå‡¦ç†ã¯æ–‡ç« ã®æ„å‘³ã‚’ç†è§£ã™ã‚‹æŠ€è¡“ã§ã™ã€‚",
            "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³ã¯ç”»åƒèªè­˜ã«ä½¿ã‚ã‚Œã¾ã™ã€‚"
        ];
        
        const searchableData = [
            "Pythonã§æ©Ÿæ¢°å­¦ç¿’ã‚’å§‹ã‚ã‚‹æ–¹æ³•",
            "TensorFlowã®åŸºæœ¬çš„ãªä½¿ã„æ–¹",
            "PyTorchã«ã‚ˆã‚‹ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°å…¥é–€",
            "scikit-learnã§åˆ†é¡å•é¡Œã‚’è§£ã",
            "Kerasã‚’ä½¿ã£ãŸç”»åƒèªè­˜ã®å®Ÿè£…",
            "è‡ªç„¶è¨€èªå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªspaCyã®æ´»ç”¨",
            "BERTãƒ¢ãƒ‡ãƒ«ã®æ—¥æœ¬èªã§ã®ä½¿ç”¨æ–¹æ³•",
            "GPTãƒ¢ãƒ‡ãƒ«ã®ä»•çµ„ã¿ã¨å¿œç”¨",
            "æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®è©•ä¾¡æŒ‡æ¨™ã«ã¤ã„ã¦",
            "éå­¦ç¿’ã‚’é˜²ãæ­£å‰‡åŒ–æ‰‹æ³•",
            "ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†ã¨ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°æ‰‹æ³•",
            "ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®å®Ÿè·µ",
            "ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®è‡ªå‹•åŒ–",
            "ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã«ã‚ˆã‚‹ç²¾åº¦å‘ä¸Š",
            "æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰",
            "ç•°å¸¸æ¤œçŸ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Ÿè£…",
            "æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã¨é–‹ç™º",
            "ç”»åƒã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®æ‰‹æ³•",
            "éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰æ–¹æ³•",
            "å¼·åŒ–å­¦ç¿’ã‚’ä½¿ã£ãŸã‚²ãƒ¼ãƒ AIé–‹ç™º"
        ];
        
        async function initializeApp() {
            await init();
            embedder = new IncrementalEmbedder(0.1); // é–¾å€¤ã‚’ä¸‹ã’ã¦å†å­¦ç¿’ã—ã‚„ã™ã
            updateStats();
            console.log('Embedder initialized');
        }
        
        function updateStats() {
            const searchableCount = embedder.get_searchable_count();
            document.getElementById('total-docs').textContent = totalDocCount;
            document.getElementById('training-docs').textContent = trainingOnlyCount;
            document.getElementById('searchable-docs').textContent = searchableCount;
            document.getElementById('vocab-size').textContent = embedder.get_vocabulary_size();
        }
        
        window.switchTab = function(tabName) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        window.addTrainingDoc = function() {
            const text = document.getElementById('training-input').value.trim();
            if (!text) return;
            
            try {
                embedder.add_document_for_training(text, 64);
                totalDocCount++;
                trainingOnlyCount++;
                updateStats();
                document.getElementById('training-input').value = '';
                console.log('Added training document:', text);
                checkRetraining();
            } catch (e) {
                console.error('Error adding training document:', e);
            }
        }
        
        window.addSearchableDoc = function() {
            const text = document.getElementById('searchable-input').value.trim();
            if (!text) return;
            
            try {
                embedder.add_document(text, 64);
                totalDocCount++;
                updateStats();
                document.getElementById('searchable-input').value = '';
                console.log('Added searchable document:', text);
                checkRetraining();
            } catch (e) {
                console.error('Error adding searchable document:', e);
            }
        }
        
        window.addSampleTrainingData = function() {
            const startTime = performance.now();
            
            // 100ä»¶ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            for (let i = 0; i < 100; i++) {
                const doc = trainingData[i % trainingData.length] + ` (ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³${i})`;
                embedder.add_document_for_training(doc, 64);
                totalDocCount++;
                trainingOnlyCount++;
            }
            
            const elapsed = performance.now() - startTime;
            updateStats();
            console.log(`Added 100 training documents in ${elapsed.toFixed(2)}ms`);
            checkRetraining();
        }
        
        window.addSampleSearchableData = function() {
            const startTime = performance.now();
            
            // 20ä»¶ã®æ¤œç´¢å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆã™ã¹ã¦ç•°ãªã‚‹æ–‡ç« ï¼‰
            for (let i = 0; i < searchableData.length && i < 20; i++) {
                embedder.add_document(searchableData[i], 64);
                totalDocCount++;
            }
            
            const elapsed = performance.now() - startTime;
            updateStats();
            console.log(`Added 20 searchable documents in ${elapsed.toFixed(2)}ms`);
            checkRetraining();
        }
        
        function checkRetraining() {
            if (embedder.is_retraining()) {
                document.getElementById('retrain-status').textContent = 'å†å­¦ç¿’ä¸­...';
                document.getElementById('retrain-progress').style.display = 'block';
                document.getElementById('retrain-btn').disabled = true;
                
                // å†å­¦ç¿’ã®é€²è¡Œã‚’ç›£è¦–
                const interval = setInterval(() => {
                    if (embedder.step_retrain()) {
                        // å†å­¦ç¿’å®Œäº†
                        clearInterval(interval);
                        document.getElementById('retrain-status').textContent = 'å†å­¦ç¿’å®Œäº†';
                        document.getElementById('retrain-progress').style.display = 'none';
                        document.getElementById('retrain-btn').disabled = false;
                        updateStats();
                        
                        setTimeout(() => {
                            document.getElementById('retrain-status').textContent = 'å¾…æ©Ÿä¸­';
                        }, 2000);
                    } else {
                        // é€²è¡ŒçŠ¶æ³ã‚’æ›´æ–°
                        const progress = embedder.get_retrain_progress() * 100;
                        document.getElementById('retrain-progress').value = progress;
                    }
                }, 50);
            }
        }
        
        window.forceRetrain = function() {
            if (totalDocCount === 0) {
                alert('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ã‹ã‚‰å†å­¦ç¿’ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            try {
                embedder.start_background_retrain(64);
                checkRetraining();
                console.log('Force retrain started');
            } catch (e) {
                console.error('Error starting retrain:', e);
            }
        }
        
        window.searchSimilar = function() {
            const query = document.getElementById('query-input').value.trim();
            if (!query) return;
            
            const startTime = performance.now();
            const results = embedder.find_similar(query, 10);
            const elapsed = performance.now() - startTime;
            
            let html = `<h3>æ¤œç´¢çµæœ (${elapsed.toFixed(2)}ms)</h3>`;
            
            if (results.length === 0) {
                html += '<p>æ¤œç´¢å¯¾è±¡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            } else {
                results.forEach((doc, idx) => {
                    html += `<div class="result-item">
                        <strong>#${idx + 1}</strong> ${doc}
                    </div>`;
                });
            }
            
            document.getElementById('search-results').innerHTML = html;
        }
        
        window.searchWithScores = function() {
            const query = document.getElementById('query-input').value.trim();
            if (!query) return;
            
            const startTime = performance.now();
            const resultsJson = embedder.find_similar_with_scores(query, 10);
            const elapsed = performance.now() - startTime;
            
            const results = JSON.parse(resultsJson);
            
            let html = `<h3>ã‚¹ã‚³ã‚¢ä»˜ãæ¤œç´¢çµæœ (${elapsed.toFixed(2)}ms)</h3>`;
            
            if (results.length === 0) {
                html += '<p>æ¤œç´¢å¯¾è±¡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            } else {
                results.forEach((item, idx) => {
                    html += `<div class="result-item">
                        <span class="result-score">${item.score.toFixed(4)}</span>
                        <strong>#${idx + 1}</strong> ${item.document}
                    </div>`;
                });
            }
            
            document.getElementById('search-results').innerHTML = html;
        }
        
        // åˆæœŸåŒ–
        initializeApp();
    </script>
</body>
</html>