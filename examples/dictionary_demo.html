<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>japanese-tfidf-embedder - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¾æ›¸ãƒ‡ãƒ¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .card h3 {
            color: #667eea;
            margin-top: 0;
        }
        .input-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #666;
        }
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }
        .tokens {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        .token {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            border: 1px solid #dee2e6;
        }
        .token.dictionary {
            background: #d4edda;
            border-color: #28a745;
            font-weight: bold;
        }
        .token.normal {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .status {
            padding: 8px 16px;
            border-radius: 5px;
            display: inline-block;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.ready { 
            background: #d4edda; 
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.loading { 
            background: #fff3cd; 
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .status.error { 
            background: #f8d7da; 
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .example-dictionary {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .similarity-score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 10px;
            margin: 10px 0;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-card {
            padding: 15px;
            border-radius: 8px;
            background: white;
            border: 2px solid #e0e0e0;
        }
        .comparison-card h4 {
            margin: 0 0 10px 0;
            color: #666;
        }
        .highlight {
            background: #fff59d;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ japanese-tfidf-embedder - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¾æ›¸ãƒ‡ãƒ¢</h1>
        
        <div class="status" id="status">Loading WASM module...</div>

        <div class="grid">
            <div class="card">
                <h3>ğŸ“š ãƒ¦ãƒ¼ã‚¶ãƒ¼è¾æ›¸è¨­å®š</h3>
                
                <div class="input-group">
                    <label for="dictionary">è¾æ›¸ã‚¨ãƒ³ãƒˆãƒªãƒ¼ (JSONå½¢å¼):</label>
                    <textarea id="dictionary" rows="12" placeholder='[
  {
    "surface": "äººå·¥çŸ¥èƒ½",
    "variants": ["AI", "ã‚¨ãƒ¼ã‚¢ã‚¤", "Artificial Intelligence"]
  },
  {
    "surface": "æ©Ÿæ¢°å­¦ç¿’",
    "variants": ["ML", "ãƒã‚·ãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Machine Learning"]
  }
]'>[
  {
    "surface": "äººå·¥çŸ¥èƒ½",
    "variants": ["AI", "ã‚¨ãƒ¼ã‚¢ã‚¤", "Artificial Intelligence"]
  },
  {
    "surface": "æ©Ÿæ¢°å­¦ç¿’",
    "variants": ["ML", "ãƒã‚·ãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Machine Learning"]
  },
  {
    "surface": "æ·±å±¤å­¦ç¿’",
    "variants": ["DL", "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Deep Learning"]
  },
  {
    "surface": "è‡ªç„¶è¨€èªå‡¦ç†",
    "variants": ["NLP", "Natural Language Processing"]
  },
  {
    "surface": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³",
    "variants": ["CV", "Computer Vision", "ç”»åƒèªè­˜"]
  }
]</textarea>
                </div>
                
                <button onclick="applyDictionary()">è¾æ›¸ã‚’é©ç”¨</button>
                <button onclick="clearDictionary()">è¾æ›¸ã‚’ã‚¯ãƒªã‚¢</button>
                <button onclick="loadExampleDictionary()">ã‚µãƒ³ãƒ—ãƒ«è¾æ›¸ã‚’èª­ã¿è¾¼ã¿</button>
                
                <div id="dictionaryStatus" class="result" style="display: none;"></div>
            </div>

            <div class="card">
                <h3>ğŸ” ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ†ã‚¹ãƒˆ</h3>
                
                <div class="input-group">
                    <label for="testText">å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:</label>
                    <textarea id="testText" rows="4" placeholder="è¾æ›¸ã®æ­£è¦åŒ–ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">AIã¨MLã®æŠ€è¡“ã‚’ä½¿ã£ã¦ã€NLPã‚„Computer Visionã®ç ”ç©¶ã‚’ã—ã¦ã„ã¾ã™ã€‚ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã¯äººå·¥çŸ¥èƒ½ã®é‡è¦ãªåˆ†é‡ã§ã™ã€‚</textarea>
                </div>
                
                <button onclick="processText()">ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†</button>
                
                <div id="processResult" class="result" style="display: none;">
                    <h4>ãƒˆãƒ¼ã‚¯ãƒ³åŒ–çµæœ:</h4>
                    <div id="tokens" class="tokens"></div>
                </div>
            </div>
        </div>

        <h2>ğŸ“Š é¡ä¼¼åº¦æ¯”è¼ƒ</h2>
        
        <div class="card">
            <div class="input-group">
                <label for="text1">ãƒ†ã‚­ã‚¹ãƒˆ1:</label>
                <input type="text" id="text1" value="AIã¨MLã®ç ”ç©¶" placeholder="æœ€åˆã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">
            </div>
            
            <div class="input-group">
                <label for="text2">ãƒ†ã‚­ã‚¹ãƒˆ2:</label>
                <input type="text" id="text2" value="äººå·¥çŸ¥èƒ½ã¨æ©Ÿæ¢°å­¦ç¿’ã®ç ”ç©¶" placeholder="2ç•ªç›®ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...">
            </div>
            
            <button onclick="calculateSimilarity()">é¡ä¼¼åº¦ã‚’è¨ˆç®—</button>
            
            <div class="comparison-grid" id="comparisonResult" style="display: none;">
                <div class="comparison-card">
                    <h4>è¾æ›¸ãªã—</h4>
                    <div class="similarity-score" id="similarityWithout">-</div>
                    <div id="tokensWithout" class="tokens"></div>
                </div>
                <div class="comparison-card">
                    <h4>è¾æ›¸ã‚ã‚Š</h4>
                    <div class="similarity-score" id="similarityWith">-</div>
                    <div id="tokensWith" class="tokens"></div>
                </div>
            </div>
        </div>

        <h2>ğŸ’¡ ä»•çµ„ã¿</h2>
        
        <div class="card">
            <p>ã“ã®ãƒ‡ãƒ¢ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¾æ›¸ãŒãƒ†ã‚­ã‚¹ãƒˆã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚’ã©ã®ã‚ˆã†ã«æ”¹å–„ã™ã‚‹ã‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š</p>
            <ul>
                <li><strong>è¡¨å±¤å½¢ï¼ˆSurface Formï¼‰:</strong> ç”¨èªã®æ­£è¦åŒ–ã•ã‚ŒãŸæ¨™æº–çš„ãªè¡¨ç¾</li>
                <li><strong>ç•°è¡¨è¨˜ï¼ˆVariantsï¼‰:</strong> è¡¨å±¤å½¢ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹åˆ¥è¡¨è¨˜ã€ç•¥èªã€åŒç¾©èª</li>
                <li><strong>ãƒˆãƒ¼ã‚¯ãƒ³åŒ–:</strong> ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†æ™‚ã«ã€ç•°è¡¨è¨˜ã¯è‡ªå‹•çš„ã«è¡¨å±¤å½¢ã«ç½®æ›ã•ã‚Œã¾ã™</li>
                <li><strong>é¡ä¼¼åº¦:</strong> åŒã˜æ¦‚å¿µã®ç•°ãªã‚‹è¡¨è¨˜ã‚’ä½¿ç”¨ã™ã‚‹æ–‡æ›¸é–“ã§ã€ã‚ˆã‚Šé«˜ã„é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ãŒå¾—ã‚‰ã‚Œã¾ã™</li>
            </ul>
            
            <div class="example-dictionary">
                <strong>ãƒ¡ãƒªãƒƒãƒˆã®ä¾‹:</strong>
                <ul>
                    <li>"AI" â†’ "äººå·¥çŸ¥èƒ½" ï¼ˆè‹±èªç•¥èªã‹ã‚‰æ—¥æœ¬èªã¸ï¼‰</li>
                    <li>"ã‚¨ãƒ¼ã‚¢ã‚¤" â†’ "äººå·¥çŸ¥èƒ½" ï¼ˆã‚«ã‚¿ã‚«ãƒŠã‹ã‚‰æ¼¢å­—ã¸ï¼‰</li>
                    <li>"ML" â†’ "æ©Ÿæ¢°å­¦ç¿’" ï¼ˆæŠ€è¡“çš„ãªç•¥èªï¼‰</li>
                    <li>è¨€èªé–“ãƒ»æ–‡å­—ç¨®é–“ã®ãƒãƒƒãƒãƒ³ã‚°ç²¾åº¦å‘ä¸Š</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        import init, { IncrementalEmbedder, StableHashEmbedder } from '../pkg/japanese_tfidf_embedder.js';
        
        let embedderWithDict = null;
        let embedderWithoutDict = null;
        let isReady = false;
        let currentDictionary = null;

        async function initialize() {
            try {
                const statusEl = document.getElementById('status');
                statusEl.textContent = 'WASMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...';
                statusEl.className = 'status loading';
                
                await init();
                
                // Initialize two embedders for comparison
                // Use higher update threshold to prevent automatic retraining during document addition
                embedderWithDict = new IncrementalEmbedder(2.0);
                embedderWithoutDict = new IncrementalEmbedder(2.0);
                
                // Apply default dictionary to embedderWithDict BEFORE adding documents
                const defaultDict = [
                    {
                        "surface": "äººå·¥çŸ¥èƒ½",
                        "variants": ["AI", "ã‚¨ãƒ¼ã‚¢ã‚¤", "Artificial Intelligence"]
                    },
                    {
                        "surface": "æ©Ÿæ¢°å­¦ç¿’",
                        "variants": ["ML", "ãƒã‚·ãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Machine Learning"]
                    },
                    {
                        "surface": "æ·±å±¤å­¦ç¿’",
                        "variants": ["DL", "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Deep Learning"]
                    },
                    {
                        "surface": "è‡ªç„¶è¨€èªå‡¦ç†",
                        "variants": ["NLP", "Natural Language Processing"]
                    },
                    {
                        "surface": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³",
                        "variants": ["CV", "Computer Vision", "ç”»åƒèªè­˜"]
                    }
                ];
                
                // Set the dictionary for embedderWithDict
                embedderWithDict.set_dictionary(JSON.stringify(defaultDict));
                currentDictionary = defaultDict;
                document.getElementById('dictionary').value = JSON.stringify(defaultDict, null, 2);
                
                // Add some sample documents to both
                const sampleDocs = [
                    "äººå·¥çŸ¥èƒ½ã®ç ”ç©¶é–‹ç™º",
                    "æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ",
                    "æ·±å±¤å­¦ç¿’ãƒ¢ãƒ‡ãƒ«",
                    "è‡ªç„¶è¨€èªå‡¦ç†æŠ€è¡“",
                    "AIã¨MLã®æŠ€è¡“é©æ–°",
                    "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®å¿œç”¨",
                    "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³ã®ç™ºå±•",
                    "è‡ªç„¶è¨€èªå‡¦ç†ã®æœ€æ–°å‹•å‘",
                    "ã‚¨ãƒ¼ã‚¢ã‚¤ã«ã‚ˆã‚‹ç”»åƒèªè­˜",
                    "NLPã¨CVã®èåˆæŠ€è¡“"
                ];
                
                for (const doc of sampleDocs) {
                    embedderWithDict.add_document(doc, 64);
                    embedderWithoutDict.add_document(doc, 64);
                }
                
                // Train the models by stepping through retraining
                statusEl.textContent = 'ãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ä¸­...';
                
                // Check if retraining is needed and start if not already in progress
                try {
                    embedderWithDict.start_background_retrain(64);
                } catch (e) {
                    // Already retraining, that's fine
                    console.log('embedderWithDict already retraining');
                }
                
                try {
                    embedderWithoutDict.start_background_retrain(64);
                } catch (e) {
                    // Already retraining, that's fine
                    console.log('embedderWithoutDict already retraining');
                }
                
                // Train embedderWithDict
                let maxSteps = 100;
                for (let i = 0; i < maxSteps; i++) {
                    const done = embedderWithDict.step_retrain();
                    if (done) break;
                }
                
                // Train embedderWithoutDict
                for (let i = 0; i < maxSteps; i++) {
                    const done = embedderWithoutDict.step_retrain();
                    if (done) break;
                }
                
                statusEl.textContent = 'æº–å‚™å®Œäº†ï¼æ¯”è¼ƒç”¨ã«ç‰‡æ–¹ã®Embedderã«è¾æ›¸ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚';
                statusEl.className = 'status ready';
                isReady = true;
                
            } catch (err) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', err);
                document.getElementById('status').textContent = `ã‚¨ãƒ©ãƒ¼: ${err.message}`;
                document.getElementById('status').className = 'status error';
            }
        }

        window.applyDictionary = function() {
            if (!isReady) {
                alert('åˆæœŸåŒ–ãŒå®Œäº†ã™ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„');
                return;
            }
            
            const dictionaryText = document.getElementById('dictionary').value;
            const statusEl = document.getElementById('dictionaryStatus');
            
            try {
                // Parse to validate JSON
                const dictionary = JSON.parse(dictionaryText);
                
                // Apply to the embedder with dictionary
                embedderWithDict.set_dictionary(dictionaryText);
                currentDictionary = dictionary;
                
                // Retrain the model after applying new dictionary
                statusEl.style.display = 'block';
                statusEl.innerHTML = `â³ è¾æ›¸ã‚’é©ç”¨ä¸­ã€ãƒ¢ãƒ‡ãƒ«ã‚’å†è¨“ç·´ã—ã¦ã„ã¾ã™...`;
                
                // Start retraining
                embedderWithDict.start_background_retrain(64);
                
                // Step through retraining
                let steps = 0;
                const retrainInterval = setInterval(() => {
                    const done = embedderWithDict.step_retrain();
                    steps++;
                    if (done || steps > 100) {
                        clearInterval(retrainInterval);
                        statusEl.innerHTML = `âœ… è¾æ›¸ãŒé©ç”¨ã•ã‚Œã€ãƒ¢ãƒ‡ãƒ«ãŒå†è¨“ç·´ã•ã‚Œã¾ã—ãŸï¼<br>
                            <strong>${dictionary.length}</strong>å€‹ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã€
                            åˆè¨ˆ<strong>${dictionary.reduce((sum, entry) => sum + entry.variants.length, 0)}</strong>å€‹ã®ç•°è¡¨è¨˜ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚`;
                    }
                }, 10);
                    
            } catch (err) {
                statusEl.style.display = 'block';
                statusEl.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${err.message}<br>JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`;
            }
        };

        window.clearDictionary = function() {
            if (!isReady) return;
            
            embedderWithDict.clear_dictionary();
            currentDictionary = null;
            
            const statusEl = document.getElementById('dictionaryStatus');
            statusEl.style.display = 'block';
            statusEl.innerHTML = 'â³ è¾æ›¸ã‚’ã‚¯ãƒªã‚¢ä¸­ã€ãƒ¢ãƒ‡ãƒ«ã‚’å†è¨“ç·´ã—ã¦ã„ã¾ã™...';
            
            // Retrain the model after clearing dictionary
            embedderWithDict.start_background_retrain(64);
            
            // Step through retraining
            let steps = 0;
            const retrainInterval = setInterval(() => {
                const done = embedderWithDict.step_retrain();
                steps++;
                if (done || steps > 100) {
                    clearInterval(retrainInterval);
                    statusEl.innerHTML = 'ğŸ”„ è¾æ›¸ãŒã‚¯ãƒªã‚¢ã•ã‚Œã€ãƒ¢ãƒ‡ãƒ«ãŒå†è¨“ç·´ã•ã‚Œã¾ã—ãŸã€‚';
                }
            }, 10);
        };

        window.loadExampleDictionary = function() {
            const exampleDict = [
                {
                    "surface": "äººå·¥çŸ¥èƒ½",
                    "variants": ["AI", "ã‚¨ãƒ¼ã‚¢ã‚¤", "Artificial Intelligence", "A.I."]
                },
                {
                    "surface": "æ©Ÿæ¢°å­¦ç¿’",
                    "variants": ["ML", "ãƒã‚·ãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Machine Learning", "ãƒã‚·ãƒ¼ãƒ³ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°"]
                },
                {
                    "surface": "æ·±å±¤å­¦ç¿’",
                    "variants": ["DL", "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "Deep Learning", "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ»ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°"]
                },
                {
                    "surface": "è‡ªç„¶è¨€èªå‡¦ç†",
                    "variants": ["NLP", "Natural Language Processing", "è¨€èªå‡¦ç†"]
                },
                {
                    "surface": "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ§ãƒ³",
                    "variants": ["CV", "Computer Vision", "ç”»åƒèªè­˜", "è¦–è¦šèªè­˜"]
                },
                {
                    "surface": "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯",
                    "variants": ["NN", "Neural Network", "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ"]
                },
                {
                    "surface": "å¼·åŒ–å­¦ç¿’",
                    "variants": ["RL", "Reinforcement Learning", "ãƒªã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒˆãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°"]
                },
                {
                    "surface": "è»¢ç§»å­¦ç¿’",
                    "variants": ["Transfer Learning", "ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚¡ãƒ¼ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°", "ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°"]
                }
            ];
            
            document.getElementById('dictionary').value = JSON.stringify(exampleDict, null, 2);
            applyDictionary();
        };

        window.processText = function() {
            if (!isReady) return;
            
            const text = document.getElementById('testText').value;
            if (!text) return;
            
            // This is a demonstration - actual tokenization happens internally
            // We'll show the effect through similarity scores
            const resultEl = document.getElementById('processResult');
            const tokensEl = document.getElementById('tokens');
            
            resultEl.style.display = 'block';
            tokensEl.innerHTML = '';
            
            // Simulate showing dictionary matches
            if (currentDictionary) {
                let processedText = text;
                const matches = [];
                
                for (const entry of currentDictionary) {
                    for (const variant of entry.variants) {
                        if (text.includes(variant)) {
                            matches.push({
                                variant: variant,
                                surface: entry.surface
                            });
                        }
                    }
                }
                
                // Display matches as tokens
                if (matches.length > 0) {
                    tokensEl.innerHTML = '<strong>è¾æ›¸ãƒãƒƒãƒãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:</strong><br>';
                    for (const match of matches) {
                        const tokenEl = document.createElement('span');
                        tokenEl.className = 'token dictionary';
                        tokenEl.textContent = `${match.variant} â†’ ${match.surface}`;
                        tokensEl.appendChild(tokenEl);
                    }
                } else {
                    tokensEl.innerHTML = 'è¾æ›¸ãƒãƒƒãƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ¨™æº–ã®N-gramã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã•ã‚Œã¾ã™ã€‚';
                }
                
                // Add sample n-grams
                tokensEl.innerHTML += '<br><br><strong>ã‚µãƒ³ãƒ—ãƒ«N-gram:</strong><br>';
                const sampleTokens = ['ç ”ç©¶', 'ã—ã¦', 'ã„ã¾ã™', 'æŠ€è¡“', 'ä½¿ã£ã¦'];
                for (const token of sampleTokens) {
                    if (text.includes(token)) {
                        const tokenEl = document.createElement('span');
                        tokenEl.className = 'token normal';
                        tokenEl.textContent = token;
                        tokensEl.appendChild(tokenEl);
                    }
                }
            } else {
                tokensEl.innerHTML = 'è¾æ›¸ãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ¨™æº–ã®N-gramãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚';
            }
        };

        window.calculateSimilarity = function() {
            if (!isReady) return;
            
            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;
            
            if (!text1 || !text2) {
                alert('ä¸¡æ–¹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // Calculate similarity with and without dictionary
            const simWithDict = embedderWithDict.get_similarity(text1, text2);
            const simWithoutDict = embedderWithoutDict.get_similarity(text1, text2);
            
            // Display results
            const resultEl = document.getElementById('comparisonResult');
            resultEl.style.display = 'block';
            
            document.getElementById('similarityWithout').textContent = 
                (simWithoutDict * 100).toFixed(1) + '%';
            document.getElementById('similarityWith').textContent = 
                (simWithDict * 100).toFixed(1) + '%';
            
            // Show token differences (simulated)
            const tokensWithoutEl = document.getElementById('tokensWithout');
            const tokensWithEl = document.getElementById('tokensWith');
            
            tokensWithoutEl.innerHTML = '<small>æ¨™æº–ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã¯å…ƒã®å½¢å¼ã‚’ä¿æŒ</small>';
            tokensWithEl.innerHTML = '<small>è¾æ›¸ã¯ç•°è¡¨è¨˜ã‚’è¡¨å±¤å½¢ã«æ­£è¦åŒ–</small>';
            
            // Highlight improvement
            if (simWithDict > simWithoutDict) {
                document.getElementById('similarityWith').style.background = '#d4edda';
            }
        };

        // Initialize on load
        initialize();
    </script>
</body>
</html>